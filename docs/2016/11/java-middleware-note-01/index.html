<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>大型网站系统与Java中间件实践-笔记-01 - 司马琦昂的博客</title><meta name=Description content="文章描述"><meta property="og:title" content="大型网站系统与Java中间件实践-笔记-01"><meta property="og:description" content="文章描述"><meta property="og:type" content="article"><meta property="og:url" content="https://brucemaa.cn/2016/11/java-middleware-note-01/"><meta property="og:image" content="https://brucemaa.cn/images/avatar.jpg"><meta property="article:published_time" content="2016-11-08T00:00:00+00:00"><meta property="article:modified_time" content="2016-11-08T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://brucemaa.cn/images/avatar.jpg"><meta name=twitter:title content="大型网站系统与Java中间件实践-笔记-01"><meta name=twitter:description content="文章描述"><meta name=application-name content="司马琦昂的博客"><meta name=apple-mobile-web-app-title content="司马琦昂的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://brucemaa.cn/2016/11/java-middleware-note-01/><link rel=prev href=https://brucemaa.cn/2016/11/java-middleware-note-02/><link rel=next href=https://brucemaa.cn/2017/04/linux-command-record-ssh/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=google-site-verification content="i1YHXYoSTAxctMaBwNPg6eXPzIy64NzevB4PKQyqJQI"><meta name=baidu-site-verification content="ed487e2486b1b01b450e21334653d1c2"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"大型网站系统与Java中间件实践-笔记-01","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/brucemaa.cn\/2016\/11\/java-middleware-note-01\/"},"image":["https:\/\/brucemaa.cn\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"Middleware","wordcount":2293,"url":"https:\/\/brucemaa.cn\/2016\/11\/java-middleware-note-01\/","datePublished":"2016-11-08T00:00:00+00:00","dateModified":"2016-11-08T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"BruceMaa","logo":"https:\/\/brucemaa.cn\/images\/avatar.png"},"author":{"@type":"Person","name":"BruceMaa"},"description":"文章描述"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=司马琦昂的博客><span class=header-title-pre><i class="fas fa-blog fa-fw"></i></span>司马琦昂的博客<span class=header-title-post><i class="fas fa-smoking-ban fa-fw"></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/BruceMaa title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=司马琦昂的博客><span class=header-title-pre><i class="fas fa-blog fa-fw"></i></span>司马琦昂的博客<span class=header-title-post><i class="fas fa-smoking-ban fa-fw"></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/documentation/>文档</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/BruceMaa title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">大型网站系统与Java中间件实践-笔记-01</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://brucemaa.cn title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>BruceMaa</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/java/><i class="far fa-folder fa-fw"></i>Java</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2016-11-08>2016-11-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2293 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#第1章-分布式系统介绍>第1章 分布式系统介绍</a><ul><li><a href=#11-初识分布式系统>1.1 初识分布式系统</a><ul><li><a href=#111-分布式系统的定义>1.1.1 分布式系统的定义</a></li><li><a href=#112-分布式系统的意义>1.1.2 分布式系统的意义</a></li></ul></li><li><a href=#12-分布式系统的基础知识>1.2 分布式系统的基础知识</a><ul><li><a href=#121-组成计算机的5要素>1.2.1 组成计算机的5要素</a></li><li><a href=#122-线程与进程的执行模式>1.2.2 线程与进程的执行模式</a><ul><li><a href=#1221-阿姆达尔定律>1.2.2.1 阿姆达尔定律</a></li><li><a href=#1222-互不通信的多线程模式>1.2.2.2 互不通信的多线程模式</a></li><li><a href=#1223-基于共享容器协同的多线程模式>1.2.2.3 基于共享容器协同的多线程模式</a></li><li><a href=#1224-通过事件协同的多线程模式>1.2.2.4 通过事件协同的多线程模式</a></li><li><a href=#1225-多进程模式>1.2.2.5 多进程模式</a></li></ul></li><li><a href=#123-网络通信基础知识>1.2.3 网络通信基础知识</a><ul><li><a href=#1231-osi与tcpip网络模型>1.2.3.1 OSI与TCP/IP网络模型</a></li><li><a href=#1232-网络io实现方式>1.2.3.2 网络IO实现方式</a><ul><li><a href=#12321-bio方式>1.2.3.2.1 BIO方式</a></li><li><a href=#12322-nio方式>1.2.3.2.2 NIO方式</a></li><li><a href=#12323-aio方式>1.2.3.2.3 AIO方式</a></li></ul></li></ul></li><li><a href=#124-如何把应用从单机扩展到分布式>1.2.4 如何把应用从单机扩展到分布式</a><ul><li><a href=#1241-输入设备的变化>1.2.4.1 输入设备的变化</a></li><li><a href=#1242-输出设备的变化>1.2.4.2 输出设备的变化</a></li><li><a href=#1243-控制器的变化>1.2.4.3 控制器的变化</a></li><li><a href=#1244-运算器的变化>1.2.4.4 运算器的变化</a></li><li><a href=#1245-存储器的变化>1.2.4.5 存储器的变化</a></li></ul></li><li><a href=#125-分布式系统的难点>1.2.5 分布式系统的难点</a><ul><li><a href=#1251-缺乏全局时钟>1.2.5.1 缺乏全局时钟</a></li><li><a href=#1252-面对故障独立性>1.2.5.2 面对故障独立性</a></li><li><a href=#1253-处理单点故障>1.2.5.3 处理单点故障</a></li><li><a href=#1254-事物的挑战>1.2.5.4 事物的挑战</a></li></ul></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=第1章-分布式系统介绍>第1章 分布式系统介绍</h2><h3 id=11-初识分布式系统>1.1 初识分布式系统</h3><h4 id=111-分布式系统的定义>1.1.1 分布式系统的定义</h4><p>首先分布式系统一定是由多个节点组成的系统，一般来说一个节点就是我们的一台计算机；然后这些节点不是孤立的，而是互相连通的；最后，这些连通的节点上部署了我们的组建，并且相互之间的操作会有协同。</p><h4 id=112-分布式系统的意义>1.1.2 分布式系统的意义</h4><p>下面三个方面
* 升级单机处理能力的性价比越来越低。
* 单机处理能力存在瓶颈。
* 出于稳定性和可用性的考虑。</p><h3 id=12-分布式系统的基础知识>1.2 分布式系统的基础知识</h3><h4 id=121-组成计算机的5要素>1.2.1 组成计算机的5要素</h4><p>冯 ∘ 诺依曼型计算机的5个组成部分：
* 输入设备
* 输出设备
* 运算器
* 控制器
* 存储器——内存和外存</p><h4 id=122-线程与进程的执行模式>1.2.2 线程与进程的执行模式</h4><p>一个进程可以有多个线程，一个线程只属于一个进程。</p><h5 id=1221-阿姆达尔定律>1.2.2.1 阿姆达尔定律</h5><p>Amdahl’s law:
S(N) = 1 / ((1 - P) + P / N)
其中，P指的是程序中可并行部分的程序在单核上执行时间的占比，N表示处理器的个数（总核心数）。S(N)是指程序在N个处理器（总核心数）相对在单个处理器（单核）中的速度提升比。</p><p>这个公式告诉我们，程序中可并行代码的比例决定你增加处理器（总核心数）所能带来的速度提升的上限，是否能达到这个上限，还取决于很多其它的因素。</p><h5 id=1222-互不通信的多线程模式>1.2.2.2 互不通信的多线程模式</h5><p>两个线程，没有交集，各自执行各自的任务和逻辑。</p><h5 id=1223-基于共享容器协同的多线程模式>1.2.2.3 基于共享容器协同的多线程模式</h5><p>有一个队列用于生产和消费，那么，这个队列就是多个线程会共享的一个容器或者是数据对象，多个线程会并发访问这个队列。</p><p>需要加锁控制并发。</p><h5 id=1224-通过事件协同的多线程模式>1.2.2.4 通过事件协同的多线程模式</h5><p>一个线程需要另一个线程的触发才能执行。</p><p>防止死锁。</p><h5 id=1225-多进程模式>1.2.2.5 多进程模式</h5><p>多进程和多线程有比较多的相似之处，也有不同。不同的最大原因是，线程是属于进程的，一个进程内的多个线程共享了进程的内存空间；而多个进程之间的内存空间是独立的，因此多个进程间通过内存共享、交换数据的方式与多个线程间的方式就有所不同。此外，进程间的通信、协调，以及通过一些事件通知活着等待一些互斥锁的释放方面，也会与多线程不一样。</p><h4 id=123-网络通信基础知识>1.2.3 网络通信基础知识</h4><p>在分布式系统中，组件分布在网络上的多个节点中，通过消息的传递来通信并且进行动作的协调。因此网络通信在分布式系统中非常重要。</p><h5 id=1231-osi与tcpip网络模型>1.2.3.1 OSI与TCP/IP网络模型</h5><p>ISO的OSI网络模型
* Application Layer
* Presentation Layer
* Session Layer
* Transport Layer
* Network Layer
* Data Link Layer
* Physical Layer</p><p>TCP/IP网络模型
* Application
* Transport
* Internetwork
* Network Interface</p><h5 id=1232-网络io实现方式>1.2.3.2 网络IO实现方式</h5><h6 id=12321-bio方式>1.2.3.2.1 BIO方式</h6><p>BIO即Blocking IO，采用阻塞的方式实现。也就是一个Socket套接字需要使用一个线程来进行处理。发生建立连接、读数据、写数据的操作时，都可能会阻塞。</p><h6 id=12322-nio方式>1.2.3.2.2 NIO方式</h6><p>NIO即Nonblocking IO，基于事件驱动思想，采用的是Reactor模式。
在NIO的方式下不是用单个线程去应对单个Socket套接字，而是统一通过Reactor对所有客户端的Socket套接字的事件做处理，然后派发到不同的线程中。</p><h6 id=12323-aio方式>1.2.3.2.3 AIO方式</h6><p>AIO即AsynchronousIO，就是异步IO。AIO采用Proactor模式。AIO与NIO的差别是，AIO在进行读写操作时，只需要调用相对应的read/write方法，并且需要传入CompletionHandler；在动作完成后，会调用CompletionHandler。</p><h4 id=124-如何把应用从单机扩展到分布式>1.2.4 如何把应用从单机扩展到分布式</h4><h5 id=1241-输入设备的变化>1.2.4.1 输入设备的变化</h5><p>将分布式中的某个节点作为输入设备。</p><h5 id=1242-输出设备的变化>1.2.4.2 输出设备的变化</h5><p>将分布式中的某个节点作为输出设备。</p><h5 id=1243-控制器的变化>1.2.4.3 控制器的变化</h5><p>单机系统中，控制器就是CPU中的控制器。在分布式系统中，负载均衡系统就算是一种控制器。</p><ul><li>使用硬件负载均衡的请求调用</li></ul><p>在集群中，这种方式对于发起请求的一方和处理请求的一方来说，都是透明的，可以称为透明代理。</p><ul><li>使用LVS的请求调用</li></ul><p>这种方式存在两个不足：
* 会增加网络的开销，这个开销一方面指的是流量，另外一方面指的是延迟。
* 这个透明代理处于请求的必经路径上，如果代理出现问题，那么所有的请求都会受到影响。</p><ul><li>采用名称服务的直连方式的请求调用</li></ul><p>在请求发起方和请求处理方的直接连接外部，有一个“名称服务”的角色，它的作用主要有两个，一个是收集提供请求处理的服务器的地址信息；另外一个是提供这些地址信息给请求发起方。</p><ul><li>采用规则服务器控制路由的请求直接调用</li></ul><p>在请求发起的机器上，会有对规则进行处理从而进行请求处理服务机器选择的代码逻辑。这个方式与名称服务方式的不同在于，名称服务是通过跟请求处理的机器交互来获得这些机器的地址的，而规则服务器的方式中，规则服务器本身并不和请求处理的机器进行交互，只负责把规则提供给请求发起的机器。</p><ul><li>Master + Worder的方式</li></ul><p>存在一个Master节点来管理任务，由Master把任务分配给不同的Worker去进行处理。</p><h5 id=1244-运算器的变化>1.2.4.4 运算器的变化</h5><p>在单机系统中，运算器是具体的电子元件，而在分布式系统中，运算器是由多个节点来组成的。</p><p>总结起来，构成运算器的多个节点在控制器的配合下对外提供服务，构成了分布式系统中的运算器。</p><h5 id=1245-存储器的变化>1.2.4.5 存储器的变化</h5><p>方案与前面相同，依次是代理、名称服务、规则服务、Master-Worker服务。</p><h4 id=125-分布式系统的难点>1.2.5 分布式系统的难点</h4><h5 id=1251-缺乏全局时钟>1.2.5.1 缺乏全局时钟</h5><p>很多时候我们使用时钟，它可以区分两个动作的顺序，而不一定要知道准确的时间。这种情况需要交给一个单独的集群来处理。</p><h5 id=1252-面对故障独立性>1.2.5.2 面对故障独立性</h5><p>在分布式系统中，整个系统的一部分有问题而其它部分正常是经常出现的情况，我们称之为故障独立性。</p><h5 id=1253-处理单点故障>1.2.5.3 处理单点故障</h5><p>在整个分布式系统中，如果某个角色或者功能只有某台单机在支撑，那么这个节点称为单点，其发生的故障称为单点故障，也是常说的SPoF(Single Point of Failure)。</p><p>一台数据库拆分到多台数据库后，出现故障的次数和总时间会比单台数据库的时候要多。也就是说，我们增加了故障出现的次数和时间，降低了故障的影响面。</p><h5 id=1254-事物的挑战>1.2.5.4 事物的挑战</h5></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2016-11-08</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/middleware/>Middleware</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2016/11/java-middleware-note-02/ class=prev rel=prev title=大型网站系统与Java中间件实践-笔记-02><i class="fas fa-angle-left fa-fw"></i>大型网站系统与Java中间件实践-笔记-02</a>
<a href=/2017/04/linux-command-record-ssh/ class=next rel=next title=Linux记录之ssh>Linux记录之ssh<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://brucemaa.cn target=_blank>BruceMaa</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"brucemaa.cn","lightTheme":"github-light","repo":"BruceMaa/blog"}}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-82993633-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-82993633-1" async></script></body></html>